// Data embedded langsung dalam script
let data = [
  {
    "nama":"Nina Aulia Angkasa",
    "nim":"G2-001",
    "foto":"Assets/foto-teman/G2-001 Nina.png" // PASTIKAN NAMA FOLDER 'assets' HURUF KECIL DI GITHUB
  },
  {
    "nama":"Daradina Ayu",
    "nim":"G2-002",
    "foto":"Assets/foto-teman/G2-002 Daradina.jpg"
  },
  {
    "nama":"Hafy Fatra Alfaid",
    "nim":"G2-003",
    "foto":"Assets/foto-teman/G2-003 Hafy.jpg"
  },
  {
    "nama":"Zaskia Anandina",
    "nim":"G2-004",
    "foto":"Assets/foto-teman/G2-004 Zaskia.jpg"
  },
  {
    "nama":"Deni Wicaksono",
    "nim":"G2-005",
    "foto":"Assets/foto-teman/G2-005 Deni.jpg"
  },
  {
    "nama":"Nailla Bilqis Ramadhani",
    "nim":"G2-006",
    "foto":"Assets/foto-teman/G2-006 Nailla.jpg"
  },
  {
    "nama":"Elzi Saputra",
    "nim":"G2-007",
    "foto":"Assets/foto-teman/G2-007 Elzi.jpg"
  },
  {
    "nama":"Jeneeke Asti Cicilia Utomo",
    "nim":"G2-008",
    "foto":"Assets/foto-teman/G2-008 Jeneeke.jpg"
  },
  {
    "nama":"Liza Novianti",
    "nim":"G2-009",
    "foto":"Assets/foto-teman/G2-009 Liza.jpg"
  },
  {
    "nama":"Shirleen Islami Puji",
    "nim":"G2-010",
    "foto":"Assets/foto-teman/G2-010 Shirleen.jpg"
  },
  {
    "nama":"Ekane Susiana",
    "nim":"G2-011",
    "foto":"Assets/foto-teman/G2-011 Ekane.jpg"
  },
  {
    "nama":"Nurul Wardah",
    "nim":"G2-012",
    "foto":"Assets/foto-teman/G2-012 Nurul.jpg"
  },
  {
    "nama":"Muhammad Ilham Aditama",
    "nim":"G2-013",
    "foto":"Assets/foto-teman/G2-013 Ilham.jpg"
  },
  {
    "nama":"Tiara Puspita",
    "nim":"G2-014",
    "foto":"Assets/foto-teman/G2-014 Tiara.jpg"
  },
  {
    "nama":"M. Firman Fahrudin",
    "nim":"G2-015",
    "foto":"Assets/foto-teman/G2-015 Firman.jpg"
  },
  {
    "nama":"Kania Saskia Ginanti",
    "nim":"G2-016",
    "foto":"Assets/foto-teman/G2-016 Kania.jpg"
  },
  {
    "nama":"Nadine Vidya Askia Hasibuan",
    "nim":"G2-017",
    "foto":"Assets/foto-teman/G2-017 Nadine.jpg"
  },
  {
    "nama":"Gusva Wellyanti",
    "nim":"G2-018",
    "foto":"Assets/foto-teman/G2-018 Gusva.jpg"
  },
  {
    "nama":"Luthficka Suci Finasty",
    "nim":"G2-019",
    "foto":"Assets/foto-teman/G2-019 Luthficka.jpg"
  },
  {
    "nama":"Muhammad Habib Ismail Ilham",
    "nim":"G2-020",
    "foto":"Assets/foto-teman/G2-020 Habib.jpg"
  },
  {
    "nama":"Hazriel Achmad Rayyan",
    "nim":"G2-021",
    "foto":"Assets/foto-teman/G2-021 Hazriel.jpg"
  },
  {
    "nama":"Dian Putri Meilani",
    "nim":"G2-022",
    "foto":"Assets/foto-teman/G2-022 Dian.jpg"
  },
  {
    "nama":"Dwi Ambarsari",
    "nim":"G2-023",
    "foto":"Assets/foto-teman/G2-023 Dwi.jpg"
  },
  {
    "nama":"Raudhah Fitria Gyasani",
    "nim":"G2-024",
    "foto":"Assets/foto-teman/G2-024 Raudhah.jpg"
  },
  {
    "nama":"M. Fazza Ilham Ersafero",
    "nim":"G2-025",
    "foto":"Assets/foto-teman/G2-025 Fazza.jpg"
  },
  {
    "nama":"Nahar Latifah",
    "nim":"G2-026",
    "foto":"Assets/foto-teman/G2-026 Nahar.jpg"
  },
  {
    "nama":"Saptian Budi Satria",
    "nim":"G2-027",
    "foto":"Assets/foto-teman/G2-027 Saptian.jpg"
  },
  {
    "nama":"Moha Joulida Adyatma",
    "nim":"G2-028",
    "foto":"Assets/foto-teman/G2-028 Moha.jpg"
  },
  {
    "nama":"Hanifah Quratu Aini Suwarno",
    "nim":"G2-029",
    "foto":"Assets/foto-teman/G2-029 Hanifah.jpg"
  },
  {
    "nama":"Suci Feliandira",
    "nim":"G2-030",
    "foto":"Assets/foto-teman/G2-030 Suci.jpg"
  },
  {
    "nama":"Fathiyyah Adriani",
    "nim":"G2-031",
    "foto":"Assets/foto-teman/G2-031 Fathiyyah.jpg"
  },
  {
    "nama":"Rama Akbar Aditya Buwono",
    "nim":"G2-032",
    "foto":"Assets/foto-teman/G2-032 Rama.jpg"
  },
  {
    "nama":"Arief Januar Saputra",
    "nim":"G2-033",
    "foto":"Assets/foto-teman/G2-033 Arief.jpg"
  },
  {
    "nama":"Azizati Saniya Kanur",
    "nim":"G2-034",
    "foto":"Assets/foto-teman/G2-034 Azizati.jpg"
  },
  {
    "nama":"Khaerunisa Sinta Dewi",
    "nim":"G2-035",
    "foto":"Assets/foto-teman/G2-035 Sinta.jpg"
  },
  {
    "nama":"Ratu Salsabila Nurhasanah",
    "nim":"G2-036",
    "foto":"Assets/foto-teman/G2-036 Ratu.jpg"
  },
  {
    "nama":"Faizarantie Zahra Cania Wibowo",
    "nim":"G2-037",
    "foto":"Assets/foto-teman/G2-037 Faiza.jpg"
  },
  {
    "nama":"Naiya Shalsabila Putri",
    "nim":"G2-038",
    "foto":"Assets/foto-teman/G2-038 Naiya.jpg"
  },
  {
    "nama":"Keysha Shaqila Iqbal",
    "nim":"G2-039",
    "foto":"Assets/foto-teman/G2-039 Keysha.jpg"
  },
  {
    "nama":"Fakhriya Nadhifa",
    "nim":"G2-040",
    "foto":"Assets/foto-teman/G2-040 Nadhifa.jpg"
  },
  {
    "nama":"Rahma Sarlita",
    "nim":"G2-041",
    "foto":"Assets/foto-teman/G2-041 Rahma.jpg"
  },
  {
    "nama":"Galuh Febby Setyani",
    "nim":"G2-042",
    "foto":"Assets/foto-teman/G2-042 Febby.jpg"
  },
  {
    "nama":"Thoriq Khairi Akbar",
    "nim":"G2-043",
    "foto":"Assets/foto-teman/G2-043 Thoriq.jpg"
  },
  {
    "nama":"Diva Khaerunnisa",
    "nim":"G2-044",
    "foto":"Assets/foto-teman/G2-044 Diva.jpg"
  },
  {
    "nama":"Raffi Syafa Yudistira B.",
    "nim":"G2-045",
    "foto":"Assets/foto-teman/G2-045 Raffi.jpg"
  },
  {
    "nama":"Daniel Destianto Nathan Immanuel",
    "nim":"G2-046",
    "foto":"Assets/foto-teman/G2-046 Daniel.jpg"
  },
  {
    "nama":"Fadhlurrahman Misbahuddien",
    "nim":"G2-047",
    "foto":"Assets/foto-teman/G2-047 Fadhlurrahman.jpg"
  },
  {
    "nama":"M. Sajali Abrori Lubis",
    "nim":"G2-048",
    "foto":"Assets/foto-teman/G2-048 Abrori.jpg"
  },
  {
    "nama":"Celine Alecia Tanasha",
    "nim":"G2-049",
    "foto":"Assets/foto-teman/G2-049 Celine.jpg"
  },
  {
    "nama":"Reiza Fitri Ananda",
    "nim":"G2-050",
    "foto":"Assets/foto-teman/G2-050 Reiza.jpg"
  },
  {
    "nama":"Ilham Nur Akbar",
    "nim":"G2-051",
    "foto":"Assets/foto-teman/G2-051 Ilham Nur.jpg"
  },
  {
    "nama":"Buana Zaky Depasko",
    "nim":"G2-052",
    "foto":"Assets/foto-teman/G2-052 Buana.jpg"
  },
  {
    "nama":"Areetha Alma Ginitri",
    "nim":"G2-053",
    "foto":"Assets/foto-teman/G2-053 Areetha.jpg"
  },
  {
    "nama":"Dini Nurhayati",
    "nim":"G2-054",
    "foto":"Assets/foto-teman/G2-054 Dini.jpg"
  },
  {
    "nama":"Muhammad Dzaki Setyawan",
    "nim":"G2-055",
    "foto":"Assets/foto-teman/G2-055 Dzaki.jpg"
  },
  {
    "nama":"Kayla Salsabila",
    "nim":"G2-056",
    "foto":"Assets/foto-teman/G2-056 Kayla.jpg"
  },
  {
    "nama":"Andi Lutfiah",
    "nim":"G2-057",
    "foto":"Assets/foto-teman/G2-057 Lutfiah.jpg"
  },
  {
    "nama":"Jimmy Syahran Ramadhan",
    "nim":"G2-058",
    "foto":"Assets/foto-teman/G2-058 Jimmy.jpg"
  },
  {
    "nama":"Muhammad Hanif",
    "nim":"G2-059",
    "foto":"Assets/foto-teman/G2-059 Hanif.jpg"
  },
  {
    "nama":"Puput Dwiyanti Nurhayadi",
    "nim":"G2-060",
    "foto":"Assets/foto-teman/G2-060 Puput.jpg"
  },
  {
    "nama":"Muhammad Rafi Razaan",
    "nim":"G2-061",
    "foto":"Assets/foto-teman/G2-061 Fizaan.jpg"
  },
  {
    "nama":"Yafiq Kazim Rahbani",
    "nim":"G2-062",
    "foto":"Assets/foto-teman/G2-062 Yafiq.jpg"
  },
  {
    "nama":"Kezia Regina",
    "nim":"G2-063",
    "foto":"Assets/foto-teman/G2-063 Kezia.jpg"
  },
  {
    "nama":"Ghaida Muthia",
    "nim":"G2-064",
    "foto":"Assets/foto-teman/G2-064 Muthia.jpg"
  },
  {
    "nama":"Najwa Salsabila",
    "nim":"G2-065",
    "foto":"Assets/foto-teman/G2-065 Najwa.jpg"
  },
  {
    "nama":"Fauzan Affan Zakiyya",
    "nim":"G2-067",
    "foto":"Assets/foto-teman/G2-067 Fauzan.jpg"
  },
  {
    "nama":"Fawwaz Bintang Adhitama",
    "nim":"G2-068",
    "foto":"Assets/foto-teman/G2-068 Bintang.jpg"
  },
  {
    "nama":"Stevania Oktavia Ganadi",
    "nim":"G2-069",
    "foto":"Assets/foto-teman/G2-069 Stevania.jpg"
  },
  {
    "nama":"Arrafi Raditya Jatmiko",
    "nim":"G2-070",
    "foto":"Assets/foto-teman/G2-070 Arrafi.jpg"
  },
  {
    "nama":"Giviorine Holly Idventha",
    "nim":"G2-071",
    "foto":"Assets/foto-teman/G2-071 Giviorine.jpg"
  },
  {
    "nama":"Alisa Rabila Putri",
    "nim":"G2-072",
    "foto":"Assets/foto-teman/G2-072 Alisa.jpg"
  },
  {
    "nama":"Finky Intania",
    "nim":"G2-073",
    "foto":"Assets/foto-teman/G2-073 Finky.jpg"
  },
  {
    "nama":"Annisa Eka Ardani",
    "nim":"G2-074",
    "foto":"Assets/foto-teman/G2-074 Annisa.jpg"
  },
  {
    "nama":"Puspita Devianti Sukma",
    "nim":"G2-075",
    "foto":"Assets/foto-teman/G2-075 Devi.jpg"
  },
  {
    "nama":"Abidah Musthavia Khanun",
    "nim":"G2-076",
    "foto":"Assets/foto-teman/G2-076 Abidah.jpg"
  },
  {
    "nama":"I Gede Arya Pradnyana",
    "nim":"G2-077",
    "foto":"Assets/foto-teman/G2-077 Arya.jpg"
  },
  {
    "nama":"Rafael Moza Christopher",
    "nim":"G2-078",
    "foto":"Assets/foto-teman/G2-078 Moza.jpg"
  },
  {
    "nama":"Nabillah Afri Dwi Kinanti",
    "nim":"G2-079",
    "foto":"Assets/foto-teman/G2-079 Nabillah.jpg"
  },
  {
    "nama":"Maiza Arnela",
    "nim":"G2-083",
    "foto":"Assets/foto-teman/G2-083 Maiza.jpg"
  },
  {
    "nama":"Yusuf Al-Qodri T.S.",
    "nim":"G2-089",
    "foto":"Assets/foto-teman/G2-089 Yusuf.jpg"
  },
  {
    "nama":"Fatia Azarine Maharani",
    "nim":"G2-092",
    "foto":"Assets/foto-teman/G2-092 Fatia.jpg"
  },
  {
    "nama":"Muhammad Daffa Edgina Haldis",
    "nim":"G2-094",
    "foto":"Assets/foto-teman/G2-094 Daffa.jpg"
  },
  {
    "nama":"Fiena Rachmanda",
    "nim":"G2-095",
    "foto":"Assets/foto-teman/G2-095 Fiena.jpg"
  },
  {
    "nama":"Muhammad Ghazie Al Ghazalie",
    "nim":"G2-096",
    "foto":"Assets/foto-teman/G2-096 Ghazie.jpg"
  },
  {
    "nama":"Muhammad Ghifari Nadeta Hidayat",
    "nim":"G2-099",
    "foto":"Assets/foto-teman/G2-099 Ghifari.jpg"
  },
  {
    "nama":"Luthfiyah Nur Abidah",
    "nim":"G2-102",
    "foto":"Assets/foto-teman/G2-102 Luthfiyah.jpg"
  },
  {
    "nama":"Sarah Febrina Chairunnisa",
    "nim":"G2-103",
    "foto":"Assets/foto-teman/G2-103 Sarah.jpg"
  },
  {
    "nama":"Debora Gadis Alexandria",
    "nim":"G2-105",
    "foto":"Assets/foto-teman/G2-105 Debora.jpg"
  },
  {
    "nama":"Naisyilla Hasna Risnandar",
    "nim":"G2-111",
    "foto":"Assets/foto-teman/G2-111 Hasna.jpg"
  },
  {
    "nama":"Elvyanti Siburian",
    "nim":"G2-112",
    "foto":"Assets/foto-teman/G2-112 Evyanti.jpg"
  }
];

let skor = 0;
let mode = "";
let selectedItem1 = null; // Mengganti selectedLeft menjadi selectedItem1
let selectedItem2 = null; // Mengganti selectedRight menjadi selectedItem2
let matchedPairs = []; // Untuk melacak pasangan yang sudah cocok
let currentRoundData = []; // Mengganti currentSample

// Langsung tampilkan mode selector karena data sudah tersedia
document.addEventListener('DOMContentLoaded', function() {
  if (data.length > 0) {
    document.getElementById("mode-selector").style.display = "block";
    // Sembunyikan game board di awal
    document.getElementById("game-board").style.display = "none";
  }
});

function startGame(selectedMode) {
  if (data.length === 0) {
    alert("Data belum siap. Silakan tunggu sebentar dan coba lagi.");
    return;
  }

  mode = selectedMode;
  skor = 0;
  matchedPairs = [];
  document.getElementById("score").innerText = "Skor: 0";
  document.getElementById("mode-selector").style.display = "none"; // Sembunyikan selector mode
  document.getElementById("game-board").style.display = "flex"; // Tampilkan game board
  generateRound();
}

function generateRound() {
  const board = document.getElementById("game-board");
  board.innerHTML = ""; // Bersihkan papan permainan
  selectedItem1 = null; // Reset pilihan
  selectedItem2 = null; // Reset pilihan

  // Ambil 4 data teman secara acak untuk round ini
  // Filter data yang belum pernah dimainkan jika Anda ingin setiap NIM/Nama/Foto hanya muncul sekali
  // Untuk kesederhanaan, kita akan ambil 4 acak dari seluruh data
  const shuffledData = [...data].sort(() => 0.5 - Math.random());
  currentRoundData = shuffledData.slice(0, 4);

  let gameElements = [];

  currentRoundData.forEach(person => {
    // Tambahkan elemen kolom kiri
    let leftValue;
    if (mode === "nama-foto") {
      leftValue = person.nama;
    } else if (mode === "nim-foto") {
      leftValue = person.nim;
    } else if (mode === "nim-nama") {
      leftValue = person.nim;
    }
    gameElements.push({ type: 'left', value: leftValue, nim: person.nim });

    // Tambahkan elemen kolom kanan
    let rightValue;
    if (mode === "nama-foto" || mode === "nim-foto") {
      rightValue = person.foto; // Ini akan menjadi path foto
    } else if (mode === "nim-nama") {
      rightValue = person.nama;
    }
    gameElements.push({ type: 'right', value: rightValue, nim: person.nim });
  });

  // Acak semua elemen yang akan ditampilkan
  gameElements = shuffleArray(gameElements);

  // Buat kolom kiri dan kanan
  const leftColumn = document.createElement("div");
  leftColumn.className = "column left-column"; // Tambahkan class untuk styling
  const rightColumn = document.createElement("div");
  rightColumn.className = "column right-column"; // Tambahkan class untuk styling

  gameElements.forEach(item => {
    const card = document.createElement("div");
    card.className = "item";
    card.dataset.nim = item.nim; // Simpan NIM sebagai data untuk pencocokan
    card.dataset.type = item.type; // Simpan tipe (left/right)

    if (item.type === 'left') {
        // Untuk kolom kiri, bisa nama atau NIM
        card.innerText = item.value;
    } else { // item.type === 'right'
        // Untuk kolom kanan, bisa foto atau nama
        if (mode === "nama-foto" || mode === "nim-foto") {
            const img = document.createElement("img");
            img.src = item.value; // Path foto
            img.alt = "Foto Teman"; // Alt text yang lebih umum
            img.onerror = function() {
                // Jika gambar gagal dimuat, tampilkan placeholder
                this.style.display = 'none'; // Sembunyikan img yang error
                const placeholder = document.createElement('div');
                placeholder.classList.add('image-placeholder'); // Tambah class untuk styling
                placeholder.innerText = 'Foto tidak tersedia';
                this.parentNode.appendChild(placeholder);
                console.error('Gagal memuat gambar:', this.src); // Log error ke console
            };
            card.appendChild(img);
        } else if (mode === "nim-nama") {
            card.innerText = item.value; // Nama teman untuk mode NIM-Nama
        }
    }

    card.onclick = () => selectItem(card);

    // Tentukan kolom berdasarkan type (left/right). Ini perlu diperbaiki jika Anda ingin acak sepenuhnya
    // Jika Anda ingin elemen benar-benar acak di satu papan, maka tidak perlu kolom kiri/kanan terpisah.
    // Namun, asumsi dari kode Anda sebelumnya adalah ada dua kolom yang terpisah.
    // Jika 'type' item adalah 'left', tambahkan ke kolom kiri, jika 'right' ke kolom kanan.
    // Ini mengasumsikan gameElements sudah diacak dan kemudian kita bagi lagi ke kolom.
    // Jika ingin tampilan acak di seluruh papan tanpa kolom terpisah, cukup append ke board langsung.
    // Untuk 'connecting two dots' umumnya ada dua 'titik' di dua kolom berbeda.
    if (item.type === 'left') {
        leftColumn.appendChild(card);
    } else {
        rightColumn.appendChild(card);
    }
  });

  board.appendChild(leftColumn);
  board.appendChild(rightColumn);
}

// Fungsi acak (Fisher-Yates shuffle)
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}


function selectItem(element) {
  // Jangan biarkan memilih item yang sudah cocok atau item yang sudah terpilih
  if (element.classList.contains('matched') || element === selectedItem1) {
    return;
  }

  if (!selectedItem1) {
    selectedItem1 = element;
    selectedItem1.classList.add('selected');
  } else if (!selectedItem2) {
    selectedItem2 = element;
    selectedItem2.classList.add('selected');

    // Pastikan tidak memilih item dari kolom yang sama (jika game-nya two-column matching)
    // Atau pastikan tidak memilih item dengan type yang sama (left vs right)
    if (selectedItem1.dataset.type === selectedItem2.dataset.type) {
        // Jika keduanya dari kolom yang sama (atau tipe yang sama), reset pilihan
        setTimeout(() => {
            selectedItem1.classList.remove('selected');
            selectedItem2.classList.remove('selected');
            selectedItem1 = null;
            selectedItem2 = null;
        }, 500); // Beri sedikit delay agar user melihat pilihan
        return;
    }


    // Cek kecocokan
    if (selectedItem1.dataset.nim === selectedItem2.dataset.nim) {
      // Cocok!
      selectedItem1.classList.add('matched');
      selectedItem2.classList.add('matched');
      skor += 10; // Tambah skor
      document.getElementById("score").innerText = `Skor: ${skor}`;
      matchedPairs.push(selectedItem1.dataset.nim); // Tambahkan NIM yang sudah cocok

      // Reset pilihan setelah kecocokan
      selectedItem1 = null;
      selectedItem2 = null;

      // Cek apakah semua pasangan sudah ditemukan
      if (matchedPairs.length === currentRoundData.length) {
        setTimeout(() => {
          alert(`Selamat! Anda telah menyelesaikan semua pasangan. Skor Anda: ${skor}`);
          generateRound(); // Lanjut ke round berikutnya
        }, 500);
      }

    } else {
      // Tidak cocok
      skor = Math.max(0, skor - 5); // Kurangi skor, tapi tidak kurang dari 0
      document.getElementById("score").innerText = `Skor: ${skor}`;

      setTimeout(() => {
        selectedItem1.classList.remove('selected');
        selectedItem2.classList.remove('selected');
        selectedItem1 = null;
        selectedItem2 = null;
      }, 1000); // Beri sedikit delay sebelum item kembali ke keadaan tidak terpilih
    }
  }
}

// Fungsi checkAnswers sudah tidak diperlukan dalam konsep matching langsung
// Ini akan digantikan oleh logika di selectItem()

function endGame() {
  alert("Permainan diakhiri. Skor akhir: " + skor);
  skor = 0;
  matchedPairs = [];
  currentRoundData = [];
  document.getElementById("game-board").innerHTML = "";
  document.getElementById("score").innerText = "Skor: 0";
  document.getElementById("mode-selector").style.display = "block"; // Tampilkan kembali selector mode
  document.getElementById("game-board").style.display = "none"; // Sembunyikan game board
}
